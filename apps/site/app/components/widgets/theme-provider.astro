{/* This is intentionally inlined to avoid FOUC. */}
<script is:inline>
  if (!globalThis.Theme) {
    const themeController = (() => {
      const storedTheme =
        typeof localStorage !== "undefined" && localStorage.getItem("x-theme");
      const mql = globalThis.matchMedia("(prefers-color-scheme: light)");
      const theme = storedTheme || (mql.matches ? "light" : "dark");
      const $ = document.documentElement;
      $.dataset.colorScheme = theme;
      $.dataset.codeTheme = `github-${theme}-default`;
      return {
        value: theme,
        selectThemeIcon(theme = storedTheme) {
          const resolvedValue = theme === "light" || theme === "dark" ? theme : "system";
          const svgs = document.querySelectorAll("theme-picker svg");
          for (const svg of svgs) svg.dataset.hidden = svg.dataset.id !== `x-${resolvedValue}`;
        },
      };
    })();
    globalThis[Symbol.for("app.theme")] = themeController;
    globalThis.Theme = themeController;
  }
</script>
