---
import { getCollection, getEntry, render } from "astro:content";

import { Icon } from "astro-icon/components";

import { hasValues } from "@/utils/guards";

import { excluded } from "@/assets/include";

import Shell from "@/components/frames/shell.astro";
import Fence from "@/components/layout/fence.astro";
import Link from "@/components/shared/link.astro";

const entry = await getEntry("pages", "home");
if (!entry) throw new Response(null, { status: 404 });

const excludedRoutes = new Set(excluded);

const [{ Content }, routes] = await Promise.all([
  render(entry),
  getCollection("routes", (data) => !excludedRoutes.has(data.id)),
]);
---

<Shell>
  <Fence>
    <section class="flex flex-col gap-6">
      <header class="my-6 flex flex-col gap-6 border border-gray-200 p-5 dark:border-gray-700">
        <h1 id="a11ty-headline" class="text-2xl">
          <span lang="he" dir="rtl">×Ö·×”Ö°×œÖ¸×Ÿ! ğŸ‘‹ğŸ¼</span>
        </h1>

        <p class="text-base">
          Iâ€™m a software engineer with a passion for safe programming languages, distributed
          systems, computer graphics, and cryptography. I build open source software and love to
          draw.
          <Link href="/about">Learn about me</Link>
          or <Link href="https://github.com/princemuel">check out my GitHub</Link>.
        </p>
      </header>

      <article class="prose prose-base max-w-none prose-gray dark:prose-invert">
        <Content frontmatter={entry.data} />
        {
          hasValues(routes) ? (
            <ul class="not-prose flex flex-col gap-3">
              {routes.map((r) => (
                <li class="flex items-center gap-2">
                  <Icon name={r.data.icon} />
                  <Link href={r.data.href}>{r.data.text}</Link>
                </li>
              ))}
            </ul>
          ) : null
        }
      </article>
    </section>
  </Fence>
</Shell>
